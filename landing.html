<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TWINNIR - Intelligent Digital Twins, Real-World Impact</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #ffffff;
            color: #000;
            line-height: 1.6;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        /* ------------------------------ */
        /* HEADER */
        /* ------------------------------ */
        .header {
            background: #ffffff;
            padding: 0.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .logo-container {
            display: flex;
            align-items: center;
            cursor: pointer;
            transition: opacity 0.2s;
            background: rgba(255, 255, 255, 0.95);
            padding: 6px 16px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .logo-container:hover {
            opacity: 0.85;
        }

        .logo-img {
            height: 32px;
            width: auto;
            max-width: 180px;
            object-fit: contain;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 2px;
            color: #000000;
            text-transform: uppercase;
        }

        .nav-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn-signin, .btn-signup {
            background: transparent;
            border: 2px solid #23d18b;
            color: #23d18b;
            padding: 0.5rem 1.5rem;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-block;
        }

        .btn-signin.hidden, .btn-signup.hidden {
            display: none !important;
        }

        /* Database Dashboard Styles */
        .db-tab.active {
            color: #23d18b !important;
            border-bottom-color: #23d18b !important;
            background: white !important;
        }

        .db-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }

        .db-item {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 1.2rem;
            transition: all 0.3s;
        }

        .db-item:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .db-item-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 0.8rem;
        }

        .db-item-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: #333;
            margin: 0;
        }

        .db-item-actions {
            display: flex;
            gap: 0.5rem;
        }

        .db-item-btn {
            padding: 0.3rem 0.6rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .db-item-btn-edit {
            background: #3498db;
            color: white;
        }

        .db-item-btn-delete {
            background: #e74c3c;
            color: white;
        }

        .db-item-field {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .db-item-field-label {
            font-weight: 600;
            color: #666;
            margin-right: 0.5rem;
        }

        .db-item-field-value {
            color: #333;
        }

        .media-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .media-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }

        .media-item img, .media-item video {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .media-item-info {
            padding: 0.5rem;
            background: #f8f9fa;
            font-size: 0.85rem;
        }

        .btn-signin:hover, .btn-signup:hover {
            background: #23d18b;
            color: #ffffff;
        }

        .btn-demo {
            background: #23d18b;
            color: #ffffff;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-demo:hover {
            background: #2ecc71;
        }

        /* ------------------------------ */
        /* HERO SECTION */
        /* ------------------------------ */
        .hero {
            background: linear-gradient(135deg, #3ddc97, #2db6f0);
            min-height: 70vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 4rem 2rem;
            position: relative;
        }

        .hero-content {
            text-align: center;
            z-index: 1;
        }

        .hero-title {
            font-size: 4rem;
            font-weight: 700;
            margin-bottom: 1rem;
            line-height: 1.2;
            letter-spacing: -0.02em;
        }

        .hero-title-light {
            color: #e0f8e0;
            display: block;
            font-weight: 400;
        }

        .hero-title-bold {
            color: #0a0a0a;
            display: block;
            font-weight: 700;
        }

        .hero-tagline {
            font-size: 2.5rem;
            font-weight: 600;
            margin-top: 1rem;
            letter-spacing: -0.01em;
        }

        .tagline-light {
            color: #e0f8e0;
            font-weight: 400;
        }

        .tagline-dark {
            color: #0a3d2d;
            font-weight: 600;
        }

        /* ------------------------------ */
        /* MAIN CONTENT */
        /* ------------------------------ */
        .main-content {
            background: #ffffff;
            padding: 4rem 2rem;
            text-align: center;
            max-width: 900px;
            margin: 0 auto;
        }

        .content-text {
            font-size: 1.25rem;
            line-height: 1.8;
            color: #666666;
            margin-bottom: 2rem;
        }

        .btn-explore {
            background: #2ecc71;
            color: #ffffff;
            border: none;
            padding: 1rem 2.5rem;
            border-radius: 18px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn-explore:hover {
            transform: translateY(-2px);
        }

        /* ------------------------------ */
        /* BOTTOM BANNER */
        /* ------------------------------ */
        .bottom-banner {
            background: linear-gradient(135deg, #40d5ff, #0070c9);
            padding: 4rem 2rem;
            position: relative;
            overflow: hidden;
        }

        .banner-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }

        .banner-shapes,
        .banner-shapes-right {
            width: 200px;
            height: 200px;
            opacity: 0.3;
        }

        .banner-text {
            flex: 1;
            text-align: center;
            position: relative;
        }

        .banner-line {
            width: 100px;
            height: 2px;
            background: #ffffff;
            margin: 0 auto 1rem;
        }

        .banner-text h3 {
            color: #ffffff;
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: 4px;
            border: 2px solid #ffffff;
            padding: 1.5rem 3rem;
            display: inline-block;
            text-transform: uppercase;
        }

        /* ------------------------------ */
        /* FOOTER */
        /* ------------------------------ */
        .footer {
            background: #000000;
            color: #ffffff;
            padding: 3rem 2rem 1rem;
        }

        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-logo {
            display: flex;
            align-items: center;
            gap: 0;
        }

        .footer-logo-img {
            height: 50px;
            width: auto;
            max-width: 200px;
            object-fit: contain;
        }

        .logo-text {
            font-size: 1.5rem;
            font-weight: 700;
            letter-spacing: 2px;
            line-height: 1.5rem;
            text-transform: uppercase;
        }

        .logo-i {
            display: flex;
            flex-direction: row;
            gap: 1px;
            margin: 0 0.1rem;
            align-items: center;
            height: 1.5rem;
        }

        .logo-line {
            width: 2px;
            height: 1.5rem;
        }

        .logo-line-blue {
            background: #00d1ff;
        }

        .logo-line-green {
            background: #00ff99;
        }

        .footer-divider {
            width: 1px;
            background: rgba(255, 255, 255, 0.2);
            min-height: 100px;
        }

        .footer-contact {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            align-items: center;
            flex: 1;
        }

        .footer-contact-item {
            display: inline-flex;
            align-items: center;
            font-size: 0.9rem;
            color: #23d18b;
            gap: 0.5rem;
        }

        .footer-contact-item svg {
            flex-shrink: 0;
        }

        .footeropyright {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.85rem;
            white-space: nowrap;
            margin-left: auto;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            align-items: center;
            justify-content: center;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal.show {
            display: flex !important;
            align-items: flex-start;
            justify-content: center;
            padding: 2rem 1rem;
            overflow-y: auto;
        }

        .modal.hidden {
            display: none !important;
        }

        .modal-content {
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 8px;
            max-width: 400px;
            width: 90%;
            position: relative;
            margin: auto;
        }

        #uploadModal .modal-content {
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            overflow-x: hidden;
        }

        #uploadModal .modal-content::-webkit-scrollbar {
            width: 8px;
        }

        #uploadModal .modal-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        #uploadModal .modal-content::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        #uploadModal .modal-content::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        .close {
            position: sticky;
            top: 0;
            right: 0;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            z-index: 1001;
            background: white;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            margin-left: auto;
            margin-bottom: -30px;
            transition: background 0.2s;
        }

        .close:hover {
            color: #000;
            background: #f0f0f0;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-group textarea {
            resize: vertical;
        }

        .btn-submit {
            width: 100%;
            padding: 0.75rem;
            background: #23d18b;
            color: #ffffff;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }

        .btn-submit:hover {
            background: #2ecc71;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }
            
            .hero-tagline {
                font-size: 1.75rem;
            }
            
            .footer-content {
                flex-direction: column;
                gap: 1.5rem;
                align-items: flex-start;
            }
            
            .footer-contact {
                flex-direction: column;
                gap: 1rem;
                align-items: flex-start;
                flex: 1;
                width: 100%;
            }
            
            .footeropyright {
                margin-left: 0;
                width: 100%;
                text-align: left;
            }
            
            .banner-text h3 {
                font-size: 1.5rem;
                padding: 1rem 2rem;
            }
        }
    </style>
</head>
<body>

    <!-- Navigation Header -->
    <header class="header">
        <nav class="nav">
            <div class="logo-container" onclick="showLandingPage()" style="cursor: pointer;">
                <div class="logo-text">TWINNIR</div>
            </div>
            <div class="nav-buttons">
                <!-- Dashboard button hidden -->
                <!-- <button id="db-dashboard-btn-header" style="display: none; padding: 0.5rem 1.5rem; background: #23d18b; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9rem; margin-right: 0.5rem;" onclick="showDatabaseDashboard()" title="Dashboard">
                    üìä Dashboard
                </button> -->
                <button id="nav-logout-btn" class="btn-logout" style="display: none; padding: 0.6rem 1.5rem; background: rgba(220, 53, 69, 0.9); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9rem; margin-right: 0.5rem;" onclick="handleLogout()">Logout</button>
                <button class="btn-signin" onclick="showLoginModal()">Sign In</button>
                <button class="btn-signup" onclick="showSignUpModal()">Sign Up</button>
            </div>
        </nav>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="hero-content">
            <h1 class="hero-title">
                <span class="hero-title-light">Intelligent Digital Twins,</span><br>
                <span class="hero-title-bold">Real-World Impact</span>
            </h1>
            <h2 class="hero-tagline">
                <span class="tagline-light">Twin</span>
                <span class="tagline-dark">Your World</span>
            </h2>
        </div>
    </section>

    <!-- Main Content -->
    <section class="main-content">
        <p class="content-text">
            Transform your physical assets, operations, and entire environments into dynamic digital replicas, unlocking unparalleled insights, efficiency, and innovation across every sector.
        </p>
        <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
            <button class="btn-explore" id="explore-btn" onclick="window.location.href='index.htm'">Explore Our Solutions</button>
            <button class="btn-explore" onclick="showDemoModal()">Request a Demo</button>
        </div>
    </section>

    <!-- Bottom Banner -->
    <section class="bottom-banner">
        <div class="banner-content">
            <div class="banner-shapes"></div>
            <div class="banner-text">
                <div class="banner-line"></div>
                <h3>TWIN YOUR WORLD</h3>
            </div>
            <div class="banner-shapes-right"></div>
        </div>
    </section>

    <!-- Map Page (Hidden by default) -->
    <div id="map-page" class="page" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100vh; overflow: hidden; z-index: 999;">
        <!-- Map Container -->
        <div id="map" style="width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 1;"></div>
        
        <!-- Top Left Controls -->
        <div id="top-left-controls" style="position: absolute; top: 15px; left: 15px; z-index: 1000; display: flex; flex-direction: column; gap: 12px; max-width: 250px; pointer-events: auto;">
            <!-- Logo removed -->
            <!-- Space Dropdown -->
            <div style="background: rgba(255, 255, 255, 0.95); padding: 12px; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                <label for="space-dropdown" style="display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 8px; color: #333;">Space</label>
                <select id="space-dropdown" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.9rem; background: white;">
                    <option value="">All Spaces</option>
                    <option value="space1">Space 1</option>
                    <option value="space2">Space 2</option>
                    <option value="space3">Space 3</option>
                </select>
            </div>
            <!-- Return to Home Button -->
            <button onclick="showLandingPage()" style="padding: 10px 20px; background: rgba(0,0,0,0.8); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9rem; width: 100%;">
                ‚Üê Return to Home
            </button>
            <!-- Virtual Tour Button -->
            <button onclick="window.location.href='index.htm'" style="padding: 10px 20px; background: rgba(47, 152, 202, 0.9); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9rem; width: 100%;">
                üè† Virtual Tour
            </button>
        </div>

        <!-- Top Right Controls -->
        <div id="top-right-controls" style="position: absolute; top: 15px; right: 15px; z-index: 1000; display: flex; gap: 10px; align-items: flex-start; flex-wrap: wrap; max-width: 70%; pointer-events: auto;">
            <!-- Organization Dropdown -->
            <div style="background: rgba(255, 255, 255, 0.95); padding: 12px; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                <label for="organization-dropdown" style="display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 8px; color: #333;">Organization</label>
                <select id="organization-dropdown" style="width: 200px; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.9rem; background: white;">
                    <option value="">All Organizations</option>
                    <option value="org1">Organization 1</option>
                    <option value="org2">Organization 2</option>
                    <option value="org3">Organization 3</option>
                </select>
            </div>
            <!-- Dashboard button hidden -->
            <!-- <button id="db-dashboard-btn" style="display: none; padding: 10px 20px; background: rgba(35, 209, 139, 0.9); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9rem; white-space: nowrap;" onclick="showDatabaseDashboard()" title="Dashboard">
                üìä Dashboard
            </button> -->
            <!-- Documents Button -->
            <button id="documents-btn" style="width: 45px; height: 45px; background: #23d18b; border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.2); flex-shrink: 0;" title="Documents">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                    <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                </svg>
            </button>
            <!-- Export Button -->
            <button id="export-btn" style="padding: 10px 20px; background: rgba(0,0,0,0.8); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; white-space: nowrap;" title="Export">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                    <path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z"/>
                </svg>
                Export
            </button>
            <!-- Logout Button -->
            <button id="logout-btn" style="display: none; padding: 10px 20px; background: rgba(220, 53, 69, 0.9); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9rem; white-space: nowrap;" onclick="handleLogout()">
                Logout
            </button>
        </div>

        <!-- Bottom Left Controls -->
        <div id="bottom-left-controls" style="position: absolute; bottom: 20px; left: 20px; z-index: 1000; display: flex; gap: 10px; flex-wrap: wrap; pointer-events: auto;">
            <button onclick="window.location.href='index.htm'" style="padding: 10px 20px; background: rgba(0,0,0,0.8); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9rem; white-space: nowrap;">360¬∞ VIEWS</button>
            <button style="padding: 10px 20px; background: rgba(0,0,0,0.8); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.9rem; white-space: nowrap;">DRONE FOOTAGE</button>
        </div>

        <!-- Bottom Right Controls -->
        <div id="bottom-right-controls" style="position: absolute; bottom: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; gap: 8px; align-items: flex-end; pointer-events: auto;">
            <!-- Top Row: Layers, Edit, Upload -->
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                <button id="layers-control-btn" style="width: 45px; height: 45px; background: rgba(0,0,0,0.75); border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0;" title="Layers">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                        <rect x="3" y="3" width="7" height="7" fill="white"/>
                        <rect x="14" y="3" width="7" height="7" fill="white"/>
                        <rect x="3" y="14" width="7" height="7" fill="white"/>
                        <rect x="14" y="14" width="7" height="7" fill="white"/>
                    </svg>
                </button>
                <button id="edit-control-btn" style="width: 45px; height: 45px; background: rgba(0,0,0,0.75); border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0;" title="Edit/Annotations">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="1">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                </button>
                <button id="upload-control-btn" style="display: none; width: 45px; height: 45px; background: #23d18b; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 2px 8px rgba(0,0,0,0.3);" title="Upload Location" onclick="showUploadModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                        <path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z"/>
                    </svg>
                </button>
            </div>
            <!-- Zoom Controls -->
            <div style="display: flex; flex-direction: column; gap: 5px;">
                <button id="zoom-in-btn" style="width: 45px; height: 45px; background: rgba(0,0,0,0.75); border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: bold; flex-shrink: 0;" onclick="if(window.map) window.map.zoomIn()" title="Zoom In">+</button>
                <button id="zoom-out-btn" style="width: 45px; height: 45px; background: rgba(0,0,0,0.75); border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: white; font-size: 24px; font-weight: bold; flex-shrink: 0;" onclick="if(window.map) window.map.zoomOut()" title="Zoom Out">‚àí</button>
            </div>
            <!-- Bottom Row: 3DGS, 360¬∞, Share -->
            <div style="display: flex; gap: 8px; flex-wrap: wrap; justify-content: flex-end;">
                <button style="padding: 8px 16px; background: rgba(0,0,0,0.75); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85rem; white-space: nowrap;">3DGS</button>
                <button style="padding: 8px 16px; background: rgba(0,0,0,0.75); color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.85rem; white-space: nowrap;">360¬∞</button>
                <button style="width: 45px; height: 45px; background: rgba(0,0,0,0.75); border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0;" title="Share">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="white">
                        <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Upload Location Modal -->
    <div id="uploadModal" class="modal hidden">
        <div class="modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto; margin: 2rem auto;">
            <span class="close" onclick="closeUploadModal()">&times;</span>
            <h2 style="margin-top: 0;">Upload Location</h2>
            <form id="uploadLocationForm" onsubmit="handleLocationUpload(event)">
                <div class="form-group">
                    <label for="location-name">Location Name *</label>
                    <input type="text" id="location-name" required placeholder="Enter location name">
                </div>
                
                <div class="form-group">
                    <label for="location-description">Description</label>
                    <textarea id="location-description" rows="3" placeholder="Enter description"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="location-organization">Organization (Optional)</label>
                    <select id="location-organization">
                        <option value="">Select Organization</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="location-property">Property (Optional)</label>
                    <select id="location-property">
                        <option value="">Select Property</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="location-space">Space (Optional)</label>
                    <select id="location-space">
                        <option value="">Select Space</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Media Upload (Optional)</label>
                    <input type="file" id="location-file" accept="image/*,video/*" style="width: 100%; padding: 0.5rem; margin-bottom: 0.5rem;" onchange="handleFileSelectForCoordinates(event)" data-max-size="1073741824">
                    <div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #ddd;">
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: #666; font-size: 0.9rem;">Or provide a direct link:</label>
                        <input type="url" id="location-url" placeholder="https://example.com/media/video.mp4">
                    </div>
                    <small style="color: #666; font-size: 0.85rem; display: block; margin-top: 0.5rem;">
                        üìé Upload: Images (JPG, PNG) or Videos (MP4, AVI) - Max 50MB<br>
                        üîó Link: Direct URL to media file (for larger files)<br>
                        üìç GPS coordinates will be automatically extracted from images if available
                    </small>
                </div>
                
                <div class="form-group">
                    <label>Coordinates *</label>
                    <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                        <input type="text" id="location-lat" required placeholder="Latitude (-35 to -22)" style="flex: 1;" onchange="showLocationOnMapLanding()" oninput="showLocationOnMapLanding()">
                        <input type="text" id="location-lng" required placeholder="Longitude (16 to 33)" style="flex: 1;" onchange="showLocationOnMapLanding()" oninput="showLocationOnMapLanding()">
                    </div>
                    <small style="color: #666; font-size: 0.85rem; display: block; margin-bottom: 0.5rem;">Enter decimal degrees (e.g., -26.106) or DMS format (e.g., 26;6;22.889). Location will be shown on map automatically.</small>
                </div>
                
                <button type="submit" class="btn-submit">Upload Location</button>
            </form>
        </div>
    </div>

    <!-- Database Dashboard Modal - Hidden/Disabled -->
    <div id="db-dashboard" class="modal hidden" style="display: none !important; visibility: hidden; position: fixed; z-index: -1; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); overflow-y: auto;">
        <div class="modal-content" style="max-width: 95%; max-height: 95vh; margin: 1rem auto; background: white; border-radius: 8px; padding: 0; position: relative;">
            <span class="close" onclick="closeDatabaseDashboard()" style="position: absolute; top: 15px; right: 20px; font-size: 32px; font-weight: bold; color: #666; cursor: pointer; z-index: 1001; background: white; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">&times;</span>
            
            <div style="padding: 2rem; border-bottom: 2px solid #eee;">
                <h2 style="margin: 0; color: #333; font-size: 1.8rem;">Dashboard</h2>
                <p style="margin: 0.5rem 0 0 0; color: #666;">Manage Organizations, Spaces, Assets, and more</p>
            </div>
            
            <!-- Tabs -->
            <div style="display: flex; border-bottom: 2px solid #eee; background: #f8f9fa; overflow-x: auto;">
                <button class="db-tab active" onclick="switchDbTab('organizations')" data-tab="organizations" style="padding: 1rem 1.5rem; border: none; background: transparent; cursor: pointer; font-weight: 600; color: #666; border-bottom: 3px solid transparent; transition: all 0.3s;">üè¢ Organizations</button>
                <button class="db-tab" onclick="switchDbTab('properties')" data-tab="properties" style="padding: 1rem 1.5rem; border: none; background: transparent; cursor: pointer; font-weight: 600; color: #666; border-bottom: 3px solid transparent; transition: all 0.3s;">üèòÔ∏è Properties</button>
                <button class="db-tab" onclick="switchDbTab('spaces')" data-tab="spaces" style="padding: 1rem 1.5rem; border: none; background: transparent; cursor: pointer; font-weight: 600; color: #666; border-bottom: 3px solid transparent; transition: all 0.3s;">üìç Spaces</button>
                <button class="db-tab" onclick="switchDbTab('assets')" data-tab="assets" style="padding: 1rem 1.5rem; border: none; background: transparent; cursor: pointer; font-weight: 600; color: #666; border-bottom: 3px solid transparent; transition: all 0.3s;">üîß Assets</button>
                <button class="db-tab" onclick="switchDbTab('space_types')" data-tab="space_types" style="padding: 1rem 1.5rem; border: none; background: transparent; cursor: pointer; font-weight: 600; color: #666; border-bottom: 3px solid transparent; transition: all 0.3s;">üìã Space Types</button>
                <button class="db-tab" onclick="switchDbTab('asset_types')" data-tab="asset_types" style="padding: 1rem 1.5rem; border: none; background: transparent; cursor: pointer; font-weight: 600; color: #666; border-bottom: 3px solid transparent; transition: all 0.3s;">üìã Asset Types</button>
                <button class="db-tab" onclick="switchDbTab('media')" data-tab="media" style="padding: 1rem 1.5rem; border: none; background: transparent; cursor: pointer; font-weight: 600; color: #666; border-bottom: 3px solid transparent; transition: all 0.3s;">üì∏ Media by Location</button>
            </div>
            
            <!-- Tab Content -->
            <div style="padding: 2rem; max-height: calc(95vh - 200px); overflow-y: auto;">
                <!-- Organizations Tab -->
                <div id="db-tab-organizations" class="db-tab-content active">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0;">Organizations</h3>
                        <button onclick="showAddForm('organization')" style="padding: 0.6rem 1.2rem; background: #23d18b; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">+ Add Organization</button>
                    </div>
                    <div id="organizations-list" class="db-list"></div>
                </div>
                
                <!-- Properties Tab -->
                <div id="db-tab-properties" class="db-tab-content" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0;">Properties</h3>
                        <button onclick="showAddForm('property')" style="padding: 0.6rem 1.2rem; background: #23d18b; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">+ Add Property</button>
                    </div>
                    <div id="properties-list" class="db-list"></div>
                </div>
                
                <!-- Spaces Tab -->
                <div id="db-tab-spaces" class="db-tab-content" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0;">Spaces</h3>
                        <button onclick="showAddForm('space')" style="padding: 0.6rem 1.2rem; background: #23d18b; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">+ Add Space</button>
                    </div>
                    <div id="spaces-list" class="db-list"></div>
                </div>
                
                <!-- Assets Tab -->
                <div id="db-tab-assets" class="db-tab-content" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0;">Assets</h3>
                        <button onclick="showAddForm('asset')" style="padding: 0.6rem 1.2rem; background: #23d18b; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">+ Add Asset</button>
                    </div>
                    <div id="assets-list" class="db-list"></div>
                </div>
                
                <!-- Space Types Tab -->
                <div id="db-tab-space_types" class="db-tab-content" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0;">Space Types</h3>
                        <button onclick="showAddForm('space_type')" style="padding: 0.6rem 1.2rem; background: #23d18b; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">+ Add Space Type</button>
                    </div>
                    <div id="space_types-list" class="db-list"></div>
                </div>
                
                <!-- Asset Types Tab -->
                <div id="db-tab-asset_types" class="db-tab-content" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                        <h3 style="margin: 0;">Asset Types</h3>
                        <button onclick="showAddForm('asset_type')" style="padding: 0.6rem 1.2rem; background: #23d18b; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">+ Add Asset Type</button>
                    </div>
                    <div id="asset_types-list" class="db-list"></div>
                </div>
                
                <!-- Media by Location Tab -->
                <div id="db-tab-media" class="db-tab-content" style="display: none;">
                    <h3 style="margin: 0 0 1.5rem 0;">Media Grouped by Location</h3>
                    <div id="media-list" class="db-list"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Form Modal -->
    <div id="db-form-modal" class="modal hidden" style="display: none; position: fixed; z-index: 21000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); overflow-y: auto;">
        <div class="modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto; margin: 2rem auto; background: white; padding: 2rem; border-radius: 8px; position: relative;">
            <span class="close" onclick="closeDbFormModal()" style="position: absolute; top: 10px; right: 15px; font-size: 28px; font-weight: bold; color: #666; cursor: pointer; z-index: 1001;">&times;</span>
            <h2 id="db-form-title" style="margin-top: 0;"></h2>
            <form id="db-form" onsubmit="handleDbFormSubmit(event)"></form>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-logo" style="margin-bottom: 1.5rem; display: flex; justify-content: center;">
                <img src="logo.png" alt="Twinnir Logo" class="footer-logo-img">
            </div>
            <div class="footer-contact">
                <span class="footer-contact-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                        <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
                    </svg>
                    <span>(+27) 11 656 3356</span>
                </span>
                <span class="footer-contact-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                        <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                    </svg>
                    <span>info@twinnir.com</span>
                </span>
                <span class="footer-contact-item">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="display: inline-block; vertical-align: middle; margin-right: 6px;">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                    </svg>
                    <span>Johannesburg, South Africa</span>
                </span>
            </div>
            <div class="footeropyright">
                Copyright ¬© 2025 Twinnir - All Rights Reserved.
            </div>
        </div>
    </footer>

    <!-- Request Demo Modal -->
    <div id="demoModal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="closeDemoModal()">&times;</span>
            <h2>Request a Demo</h2>
            <p style="margin-bottom: 1.5rem; color: #666;">Please provide your email and we'll get back to you soon.</p>
            <form id="demoForm" onsubmit="handleDemoRequest(event)">
                <div class="form-group">
                    <label for="demoEmail">Email Address</label>
                    <input type="email" id="demoEmail" required placeholder="your.email@example.com">
                </div>
                <button type="submit" class="btn-submit">Submit Request</button>
            </form>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="closeLoginModal()">&times;</span>
            <h2>Sign In</h2>
            <p style="margin-bottom: 1.5rem; color: #666; font-size: 0.9rem;">Sign in to access the platform or create a new account.</p>
            <form id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required placeholder="your.email@example.com">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required placeholder="Enter password">
                </div>
                <button type="submit" class="btn-submit">Sign In</button>
            </form>
            <p style="margin-top: 1rem; font-size: 0.85rem; color: #666; text-align: center;">
                Don't have an account? <a href="#" onclick="closeLoginModal(); showSignUpModal();" style="color: #23d18b; text-decoration: underline; cursor: pointer;">Sign Up</a>
            </p>
        </div>
    </div>

    <!-- Sign Up Modal -->
    <div id="signUpModal" class="modal hidden">
        <div class="modal-content">
            <span class="close" onclick="closeSignUpModal()">&times;</span>
            <h2>Create Account</h2>
            <p style="margin-bottom: 1.5rem; color: #666; font-size: 0.9rem;">Sign up to start using the platform.</p>
            <form id="signUpForm" onsubmit="handleSignUp(event)">
                <div class="form-group">
                    <label for="signUpEmail">Email</label>
                    <input type="email" id="signUpEmail" required placeholder="your.email@example.com">
                </div>
                <div class="form-group">
                    <label for="signUpPassword">Password</label>
                    <input type="password" id="signUpPassword" required placeholder="Enter password (min 6 characters)">
                </div>
                <div class="form-group">
                    <label for="signUpConfirmPassword">Confirm Password</label>
                    <input type="password" id="signUpConfirmPassword" required placeholder="Confirm password">
                </div>
                <button type="submit" class="btn-submit">Sign Up</button>
            </form>
            <p style="margin-top: 1rem; font-size: 0.85rem; color: #666; text-align: center;">
                Already have an account? <a href="#" onclick="closeSignUpModal(); showLoginModal();" style="color: #23d18b; text-decoration: underline; cursor: pointer;">Sign In</a>
            </p>
        </div>
    </div>

    <!-- Load Supabase and Leaflet -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
    <script src="config.js"></script>
    <script src="auth.js"></script>
    <script src="app.js"></script>
    <script src="db-dashboard.js"></script>

    <script>
        // Page Navigation Functions
        function showMapPage() {
            // Hide landing page sections and header
            const header = document.querySelector('.header');
            const hero = document.querySelector('.hero');
            const mainContent = document.querySelector('.main-content');
            const bottomBanner = document.querySelector('.bottom-banner');
            const footer = document.querySelector('.footer');
            
            if (header) header.style.display = 'none';
            if (hero) hero.style.display = 'none';
            if (mainContent) mainContent.style.display = 'none';
            if (bottomBanner) bottomBanner.style.display = 'none';
            if (footer) footer.style.display = 'none';
            
            // Show map page
            const mapPage = document.getElementById('map-page');
            if (mapPage) {
                mapPage.style.display = 'block';
                document.querySelector('body').style.overflow = 'hidden';
                document.querySelector('body').style.margin = '0';
                document.querySelector('body').style.padding = '0';
                
                // Initialize map if not already done
                setTimeout(() => {
                    if (typeof initializeMap === 'function' && !window.mapInitialized) {
                        initializeMap();
                        window.mapInitialized = true;
                    } else if (window.map) {
                        window.map.invalidateSize();
                        if (typeof loadMapLocations === 'function') {
                            loadMapLocations();
                        }
                    }
                }, 100);
            }
        }

        function showLandingPage() {
            // Hide map page
            const mapPage = document.getElementById('map-page');
            if (mapPage) {
                mapPage.style.display = 'none';
            }
            
            // Show header and landing page sections
            const header = document.querySelector('.header');
            const hero = document.querySelector('.hero');
            const mainContent = document.querySelector('.main-content');
            const bottomBanner = document.querySelector('.bottom-banner');
            const footer = document.querySelector('.footer');
            
            if (header) header.style.display = 'block';
            if (hero) hero.style.display = 'block';
            if (mainContent) mainContent.style.display = 'block';
            if (bottomBanner) bottomBanner.style.display = 'block';
            if (footer) footer.style.display = 'block';
            
            document.querySelector('body').style.overflow = 'auto';
        }

        // Upload Modal Functions
        async function showUploadModal() {
            if (!window.isAuthenticated) {
                showLoginModal();
                return;
            }
            const modal = document.getElementById('uploadModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('show');
                modal.style.display = 'block';
                // Populate dropdowns
                await populateUploadDropdowns();
            }
        }
        
        async function populateUploadDropdowns() {
            // Populate organizations
            const orgSelect = document.getElementById('location-organization');
            if (orgSelect) {
                const { data: orgs } = await supabase.from('organizations').select('id, name').order('name');
                orgSelect.innerHTML = '<option value="">Select Organization</option>';
                if (orgs) {
                    orgs.forEach(org => {
                        orgSelect.innerHTML += `<option value="${org.id}">${org.name}</option>`;
                    });
                }
            }
            
            // Populate properties
            const propSelect = document.getElementById('location-property');
            if (propSelect) {
                const { data: props } = await supabase.from('properties').select('id, name').order('name');
                propSelect.innerHTML = '<option value="">Select Property</option>';
                if (props) {
                    props.forEach(prop => {
                        propSelect.innerHTML += `<option value="${prop.id}">${prop.name}</option>`;
                    });
                }
            }
            
            // Populate spaces
            const spaceSelect = document.getElementById('location-space');
            if (spaceSelect) {
                const { data: spaces } = await supabase.from('spaces').select('id, name').order('name');
                spaceSelect.innerHTML = '<option value="">Select Space</option>';
                if (spaces) {
                    spaces.forEach(space => {
                        spaceSelect.innerHTML += `<option value="${space.id}">${space.name}</option>`;
                    });
                }
            }
        }
        
        // Make function globally accessible
        window.populateUploadFormDropdowns = populateUploadDropdowns;
        
        // Handle file selection for automatic coordinate extraction
        function handleFileSelectForCoordinates(event) {
            const file = event.target.files[0];
            if (!file || !file.type.startsWith('image/')) {
                return;
            }
            
            // Extract GPS coordinates from image immediately when file is selected
            if (typeof EXIF !== 'undefined') {
                EXIF.getData(file, function() {
                    const gpsLat = EXIF.getTag(this, 'GPSLatitude');
                    const gpsLatRef = EXIF.getTag(this, 'GPSLatitudeRef');
                    const gpsLng = EXIF.getTag(this, 'GPSLongitude');
                    const gpsLngRef = EXIF.getTag(this, 'GPSLongitudeRef');
                    
                    if (gpsLat && Array.isArray(gpsLat) && gpsLng && Array.isArray(gpsLng)) {
                        // Convert to decimal degrees
                        let latDecimal = gpsLat[0] + (gpsLat[1] || 0)/60 + (gpsLat[2] || 0)/3600;
                        let lngDecimal = gpsLng[0] + (gpsLng[1] || 0)/60 + (gpsLng[2] || 0)/3600;
                        
                        // Apply reference (N/S, E/W)
                        if (gpsLatRef === 'S') latDecimal = -latDecimal;
                        if (gpsLngRef === 'W') lngDecimal = -lngDecimal;
                        
                        // Validate South Africa bounds
                        if (latDecimal >= -35 && latDecimal <= -22 && lngDecimal >= 16 && lngDecimal <= 33) {
                            document.getElementById('location-lat').value = latDecimal.toFixed(6);
                            document.getElementById('location-lng').value = lngDecimal.toFixed(6);
                            
                            // Show location on map if available
                            const currentMap = map || window.map;
                            if (currentMap && typeof currentMap.setView === 'function') {
                                currentMap.setView([latDecimal, lngDecimal], 15);
                                const marker = L.marker([latDecimal, lngDecimal])
                                    .addTo(currentMap)
                                    .bindPopup('GPS extracted from image')
                                    .openPopup();
                            }
                            
                            alert('‚úÖ GPS coordinates extracted from image!\n\nLatitude: ' + latDecimal.toFixed(6) + '\nLongitude: ' + lngDecimal.toFixed(6) + '\n\nLocation shown on map. You can now fill in other details and upload.');
                        } else {
                            alert('‚ö†Ô∏è GPS coordinates found in image but are outside South Africa bounds.\n\nCoordinates: ' + latDecimal.toFixed(6) + ', ' + lngDecimal.toFixed(6) + '\n\nPlease verify or enter coordinates manually.');
                            // Still set the values so user can see them
                            document.getElementById('location-lat').value = latDecimal.toFixed(6);
                            document.getElementById('location-lng').value = lngDecimal.toFixed(6);
                        }
                    } else {
                        console.log('No GPS coordinates found in image EXIF data');
                    }
                });
            } else {
                console.warn('EXIF.js library not loaded');
            }
        }
        
        // Make function globally accessible
        window.handleFileSelectForCoordinates = handleFileSelectForCoordinates;

        function closeUploadModal() {
            const modal = document.getElementById('uploadModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('show');
                document.getElementById('uploadLocationForm').reset();
            }
        }

        // Show location on map when coordinates are entered manually (landing.html)
        function showLocationOnMapLanding() {
            const latInput = document.getElementById('location-lat');
            const lngInput = document.getElementById('location-lng');
            
            if (!latInput || !lngInput) return;
            
            function parseCoordinate(value) {
                if (!value) return null;
                if (value.includes(';')) {
                    const parts = value.split(';').map(Number);
                    if (parts.length === 3) {
                        return parts[0] + parts[1] / 60 + parts[2] / 3600;
                    }
                }
                const num = parseFloat(value);
                return isNaN(num) ? null : num;
            }
            
            const lat = parseCoordinate(latInput.value);
            const lng = parseCoordinate(lngInput.value);
            
            if (lat && lng) {
                // Validate South Africa bounds
                if (lat >= -35 && lat <= -22 && lng >= 16 && lng <= 33) {
                    const currentMap = map || window.map;
                    if (currentMap && typeof currentMap.setView === 'function') {
                        currentMap.setView([lat, lng], 15);
                        
                        // Remove existing preview marker if any
                        if (window.previewMarker) {
                            currentMap.removeLayer(window.previewMarker);
                        }
                        
                        // Add preview marker
                        const previewMarker = L.marker([lat, lng], {
                            icon: L.icon({
                                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                iconSize: [25, 41],
                                iconAnchor: [12, 41],
                                popupAnchor: [1, -34],
                                shadowSize: [41, 41]
                            })
                        })
                        .addTo(currentMap)
                        .bindPopup('Location to upload')
                        .openPopup();
                        
                        window.previewMarker = previewMarker;
                    }
                }
            }
        }
        
        // Make function globally accessible
        window.showLocationOnMapLanding = showLocationOnMapLanding;

        // Handle Location Upload
        async function handleLocationUpload(event) {
            event.preventDefault();
            
            if (!window.isAuthenticated) {
                alert('Please sign in to upload locations');
                showLoginModal();
                return;
            }

            const name = document.getElementById('location-name').value;
            const description = document.getElementById('location-description').value;
            const lat = parseCoordinate(document.getElementById('location-lat').value);
            const lng = parseCoordinate(document.getElementById('location-lng').value);
            const file = document.getElementById('location-file').files[0];
            const url = document.getElementById('location-url').value;
            
            // Check file size (1GB = 1073741824 bytes)
            if (file && file.size > 1073741824) {
                alert('File size exceeds 1GB limit. Please use a direct link for files larger than 1GB.');
                return;
            }

            if (!name || !lat || !lng) {
                alert('Please fill in all required fields (Name and Coordinates are required)');
                return;
            }

            // File or URL is optional - location can be saved without media

            try {
                let fileUrl = url || null;
                let mediaType = null;

                // Upload file if provided
                if (file) {
                    const fileExt = file.name.split('.').pop();
                    const fileName = `${Date.now()}_${Math.random().toString(36).substring(7)}.${fileExt}`;
                    const filePath = `locations/${fileName}`;

                    // Try to upload directly - bucket should exist
                    const { data: uploadData, error: uploadError } = await supabase.storage
                        .from('location-files')
                        .upload(filePath, file);

                    if (uploadError) {
                        if (uploadError.message.includes('Bucket not found') || uploadError.message.includes('not found')) {
                            alert('‚ö†Ô∏è Storage bucket "location-files" not accessible.\n\nPlease verify in Supabase:\n1. Go to Storage > Buckets\n2. Ensure "location-files" bucket exists\n3. Ensure it is marked as "Public"\n4. Check Storage Policies allow authenticated users to INSERT');
                            return;
                        } else {
                            console.error('Upload error:', uploadError);
                            alert('Upload failed: ' + uploadError.message);
                            return;
                        }
                    }

                    const { data: { publicUrl } } = supabase.storage
                        .from('location-files')
                        .getPublicUrl(filePath);

                    fileUrl = publicUrl;

                    // Determine media type
                    const fileType = file.type.toLowerCase();
                    if (fileType.startsWith('image/')) {
                        mediaType = 'image';
                    } else if (fileType.startsWith('video/')) {
                        mediaType = 'video';
                    }
                } else if (url) {
                    // Try to determine media type from URL
                    const urlLower = url.toLowerCase();
                    if (urlLower.includes('image') || urlLower.match(/\.(jpg|jpeg|png|gif|webp)/i)) {
                        mediaType = 'image';
                    } else if (urlLower.includes('video') || urlLower.match(/\.(mp4|avi|mov|webm)/i)) {
                        mediaType = 'video';
                    } else if (urlLower.includes('360') || urlLower.includes('panorama')) {
                        mediaType = '360';
                    } else if (urlLower.includes('3dgs') || urlLower.includes('3d')) {
                        mediaType = '3dgs';
                    }
                }

                // Get current user
                const { data: { user } } = await supabase.auth.getUser();
                if (!user) {
                    throw new Error('User not authenticated');
                }

                // Save location to database
                const locationData = {
                    name: name.trim(),
                    description: description ? description.trim() : null,
                    category: 'property', // Default category
                    latitude: parseFloat(lat),
                    longitude: parseFloat(lng),
                    user_id: user.id
                };

                // Add optional fields only if they exist
                if (fileUrl && fileUrl.trim()) {
                    locationData.file_url = fileUrl.trim();
                }
                if (mediaType) {
                    locationData.media_type = mediaType;
                }

                console.log('Saving location:', locationData);

                const { data, error } = await supabase
                    .from('locations')
                    .insert([locationData])
                    .select();

                if (error) {
                    console.error('Database error:', error);
                    throw new Error(error.message || 'Failed to save location to database');
                }

                if (!data || data.length === 0) {
                    throw new Error('Location was not saved. Please try again.');
                }

                alert('Location uploaded successfully!');
                closeUploadModal();
                
                // Remove preview marker if exists
                if (window.previewMarker) {
                    const currentMap = map || window.map;
                    if (currentMap) {
                        currentMap.removeLayer(window.previewMarker);
                    }
                    window.previewMarker = null;
                }
                
                // Show location on map with blue pin and image preview
                if (lat && lng) {
                    const currentMap = map || window.map;
                    if (currentMap && typeof currentMap.setView === 'function') {
                        currentMap.setView([lat, lng], 15);
                        
                        // Create blue icon
                        const blueIcon = L.icon({
                            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                            shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                            iconSize: [25, 41],
                            iconAnchor: [12, 41],
                            popupAnchor: [1, -34],
                            shadowSize: [41, 41]
                        });
                        
                        // Build popup content with image preview
                        let popupContent = `<div style="min-width: 250px; max-width: 400px;">
                            <b style="font-size: 1.1rem; color: #333;">${name}</b><br>`;
                        
                        if (description) {
                            popupContent += `<p style="margin: 0.5rem 0; color: #666;">${description}</p>`;
                        }
                        
                        if (fileUrl) {
                            if (mediaType === 'image') {
                                popupContent += `<img src="${fileUrl}" style="width: 100%; max-height: 300px; object-fit: cover; border-radius: 4px; margin-top: 0.5rem; cursor: pointer;" onclick="window.open('${fileUrl}', '_blank')" title="Click to view full size">`;
                            } else if (mediaType === 'video') {
                                popupContent += `<video src="${fileUrl}" controls style="width: 100%; max-height: 300px; border-radius: 4px; margin-top: 0.5rem;"></video>`;
                            } else {
                                popupContent += `<a href="${fileUrl}" target="_blank" style="color: #23d18b; text-decoration: underline; display: block; margin-top: 0.5rem;">View Media</a>`;
                            }
                        }
                        
                        popupContent += `</div>`;
                        
                        const marker = L.marker([lat, lng], { icon: blueIcon })
                            .addTo(currentMap)
                            .bindPopup(popupContent)
                            .openPopup();
                    }
                }
                
                // Reload map locations
                if (typeof loadMapLocations === 'function') {
                    setTimeout(() => {
                        loadMapLocations();
                    }, 500);
                }

            } catch (error) {
                console.error('Upload error:', error);
                alert('Error uploading location: ' + (error.message || 'Unknown error'));
            }
        }

        function parseCoordinate(value) {
            if (!value) return null;
            if (value.includes(';')) {
                const parts = value.split(';').map(Number);
                if (parts.length === 3) {
                    return parts[0] + parts[1] / 60 + parts[2] / 3600;
                }
            }
            const num = parseFloat(value);
            return isNaN(num) ? null : num;
        }

        // Check authentication status and show/hide upload button
        function checkAuthAndUpdateUI() {
            supabase.auth.getSession().then(({ data: { session } }) => {
                window.isAuthenticated = !!session;
                updateUIForAuth(session);
            });
        }

        function updateUIForAuth(session) {
            window.isAuthenticated = !!session;
            const uploadBtn = document.getElementById('upload-control-btn');
            const logoutBtn = document.getElementById('logout-btn');
            const navLogoutBtn = document.getElementById('nav-logout-btn');
            // Dashboard buttons disabled/hidden
            // const dbDashboardBtn = document.getElementById('db-dashboard-btn');
            // const dbDashboardBtnHeader = document.getElementById('db-dashboard-btn-header');
            const signInBtn = document.querySelector('.btn-signin');
            const signUpBtn = document.querySelector('.btn-signup');
            
            if (uploadBtn) {
                uploadBtn.style.display = window.isAuthenticated ? 'flex' : 'none';
            }
            if (logoutBtn) {
                logoutBtn.style.display = window.isAuthenticated ? 'block' : 'none';
            }
            // Update header logout button
            if (navLogoutBtn) {
                navLogoutBtn.style.display = window.isAuthenticated ? 'inline-block' : 'none';
            }
            // Dashboard buttons disabled/hidden
            // if (dbDashboardBtn) {
            //     dbDashboardBtn.style.display = window.isAuthenticated ? 'block' : 'none';
            // }
            // if (dbDashboardBtnHeader) {
            //     dbDashboardBtnHeader.style.display = window.isAuthenticated ? 'block' : 'none';
            // }
            // Hide/show sign in/sign up buttons based on auth state
            if (signInBtn && signUpBtn) {
                if (window.isAuthenticated) {
                    signInBtn.classList.add('hidden');
                    signUpBtn.classList.add('hidden');
                } else {
                    signInBtn.classList.remove('hidden');
                    signUpBtn.classList.remove('hidden');
                }
            }
        }

        // Listen for auth changes
        supabase.auth.onAuthStateChange((event, session) => {
            updateUIForAuth(session);
        });

        // Logout function
        async function handleLogout() {
            try {
                console.log('üîÑ Logging out...');
                const { error } = await supabase.auth.signOut();
                if (error) {
                    console.error('‚ùå Logout error:', error);
                    alert('Error logging out: ' + error.message);
                    return;
                }
                
                // Clear authentication state
                window.isAuthenticated = false;
                
                // Update UI immediately
                updateUIForAuth(null);
                
                // Also update via authManager if available
                if (window.authManager && typeof window.authManager.updateUIForLoggedOutUser === 'function') {
                    window.authManager.updateUIForLoggedOutUser();
                }
                
                console.log('‚úÖ Logged out successfully');
                
                // Show success message
                alert('Logged out successfully');
                
                // Optionally redirect to landing page if on a different page
                if (window.location.pathname.includes('index.htm')) {
                    window.location.href = 'landing.html';
                }
                
            } catch (error) {
                console.error('‚ùå Logout error:', error);
                alert('Error logging out: ' + (error.message || 'Unknown error'));
            }
        }
        
        // Make handleLogout globally accessible
        window.handleLogout = handleLogout;

        // Check on page load
        document.addEventListener('DOMContentLoaded', () => {
            checkAuthAndUpdateUI();
            // Also check after a short delay to ensure all elements are loaded
            setTimeout(() => {
                checkAuthAndUpdateUI();
            }, 500);
        });

        // Demo Modal Functions - Make globally accessible
        window.showDemoModal = function() {
            const modal = document.getElementById('demoModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('show');
            }
        };

        window.closeDemoModal = function() {
            const modal = document.getElementById('demoModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('show');
                const form = document.getElementById('demoForm');
                if (form) form.reset();
            }
        };

        function handleDemoRequest(event) {
            event.preventDefault();
            const email = document.getElementById('demoEmail').value;
            if (email) {
                alert('Thank you! We\'ll contact you at ' + email + ' soon.');
                closeDemoModal();
            }
        }

        // Login Modal Functions - Make globally accessible
        window.showLoginModal = function() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('show');
            } else {
                console.error('Login modal not found');
            }
        };

        window.closeLoginModal = function() {
            const modal = document.getElementById('loginModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('show');
                const form = document.getElementById('loginForm');
                if (form) form.reset();
            }
        };

        async function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: email,
                    password: password
                });

                if (error) {
                    alert(error.message || 'Login failed. Please check your credentials.');
                    return;
                }

                window.isAuthenticated = true;
                // Force immediate UI update
                updateUIForAuth(data.session);
                
                // Double check buttons are hidden
                setTimeout(() => {
                    const signInBtn = document.querySelector('.btn-signin');
                    const signUpBtn = document.querySelector('.btn-signup');
                    if (signInBtn) signInBtn.classList.add('hidden');
                    if (signUpBtn) signUpBtn.classList.add('hidden');
                    updateUIForAuth(data.session);
                }, 100);
                
                closeLoginModal();
                alert('Login successful!');
            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed. Please try again.');
            }
        }

        // Sign Up Modal Functions
        // Sign Up Modal Functions - Make globally accessible
        window.showSignUpModal = function() {
            const modal = document.getElementById('signUpModal');
            if (modal) {
                modal.classList.remove('hidden');
                modal.classList.add('show');
            } else {
                console.error('Sign Up modal not found');
            }
        };

        window.closeSignUpModal = function() {
            const modal = document.getElementById('signUpModal');
            if (modal) {
                modal.classList.add('hidden');
                modal.classList.remove('show');
                const form = document.getElementById('signUpForm');
                if (form) form.reset();
            }
        };

        async function handleSignUp(event) {
            event.preventDefault();
            const email = document.getElementById('signUpEmail').value;
            const password = document.getElementById('signUpPassword').value;
            const confirmPassword = document.getElementById('signUpConfirmPassword').value;

            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }

            if (password.length < 6) {
                alert('Password must be at least 6 characters long!');
                return;
            }

            try {
                const { data, error } = await supabase.auth.signUp({
                    email: email,
                    password: password
                });

                if (error) {
                    alert(error.message || 'Sign up failed. Please try again.');
                    return;
                }

                // Create profile automatically
                if (data.user) {
                    try {
                        const { error: profileError } = await supabase
                            .from('profiles')
                            .insert([
                                {
                                    id: data.user.id,
                                    email: email,
                                    name: email.split('@')[0],
                                    organization: 'Individual'
                                }
                            ]);

                        if (profileError) {
                            // Ignore duplicate key errors (profile might already exist)
                            if (profileError.code !== '23505') {
                                console.error('Profile creation error:', profileError);
                            }
                        }
                    } catch (profileErr) {
                        console.error('Error creating profile:', profileErr);
                        // Continue even if profile creation fails
                    }
                }

                alert('Account created successfully! Please check your email to verify your account, then sign in.');
                closeSignUpModal();
                showLoginModal();
                document.getElementById('loginEmail').value = email;
            } catch (error) {
                console.error('Sign up error:', error);
                alert('Sign up failed. Please try again.');
            }
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const demoModal = document.getElementById('demoModal');
            const loginModal = document.getElementById('loginModal');
            const signUpModal = document.getElementById('signUpModal');
            const uploadModal = document.getElementById('uploadModal');
            
            if (event.target === demoModal) {
                closeDemoModal();
            }
            if (event.target === loginModal) {
                closeLoginModal();
            }
            if (event.target === signUpModal) {
                closeSignUpModal();
            }
            if (event.target === uploadModal) {
                closeUploadModal();
            }
        }

        // Initialize map click handler for coordinate input
        document.addEventListener('DOMContentLoaded', () => {
            // This will be set up when map is initialized
            setTimeout(() => {
                if (window.map && typeof window.map.on === 'function') {
                    window.map.on('click', (e) => {
                        const latInput = document.getElementById('location-lat');
                        const lngInput = document.getElementById('location-lng');
                        if (latInput && lngInput) {
                            latInput.value = e.latlng.lat.toFixed(6);
                            lngInput.value = e.latlng.lng.toFixed(6);
                        }
                    });
                }
            }, 1000);
        });
    </script>

</body>
</html>
